<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - Readings in Philippine History</title>
    <link rel="icon" href="Images/favicon.png" type="image/png">
    <link rel="stylesheet" href="Styles/course.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="JS/supabase-config.js"></script>
    <script src="JS/db-helpers.js"></script>
    <script src="JS/course.js"></script>
    <style>
        main.main-content {
            padding: 40px 32px;
            overflow-y: auto;
            overflow-x: hidden;
            height: 100%;
            background: #f5f7fa;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo-img {
            width: 32px;
            height: 32px;
            border-radius: 6px;
        }

        /* Page Header */
        .page-title {
            margin-bottom: 40px;
            animation: fadeIn 0.4s ease;
        }

        .page-title h1 {
            font-size: 48px;
            font-weight: 800;
            color: #51513E;
            margin: 0 0 8px 0;
            letter-spacing: -1px;
        }

        .page-title p {
            font-size: 18px;
            color: #7A5B47;
            margin: 0;
            font-weight: 400;
        }

        /* Calendar Container */
        .calendar-container {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 32px;
            margin-bottom: 40px;
        }

        /* Calendar Card */
        .calendar-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(68, 41, 19, 0.08);
            transition: box-shadow 0.3s ease;
        }

        .calendar-card:hover {
            box-shadow: 0 8px 24px rgba(68, 41, 19, 0.12);
        }

        /* Calendar Header */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 28px 32px;
            border-bottom: 1px solid #e8eef5;
            background: linear-gradient(135deg, #ffffff, #f8f9fc);
        }

        .calendar-nav-btn {
            background: #f0f4f9;
            border: 1px solid #d8dfe8;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #4a5568;
            font-weight: 600;
            font-size: 20px;
        }

        .calendar-nav-btn:hover {
            border-color: #006666;
            color: white;
            background: linear-gradient(135deg, #006666, #00a8a8);
            transform: scale(1.05);
        }

        .calendar-nav-btn:active {
            transform: scale(0.95);
        }

        .calendar-month-year {
            font-size: 22px;
            font-weight: 700;
            color: #51513E;
            min-width: 220px;
            text-align: center;
            letter-spacing: -0.5px;
        }

        /* Calendar Grid */
        .calendar-grid {
            padding: 32px;
        }

        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .weekday-label {
            text-align: center;
            font-weight: 700;
            font-size: 11px;
            color: #8892a8;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding: 16px 0;
        }

        .dates-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
        }

        .calendar-date {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #e8eef5;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            font-weight: 600;
            color: #4a5568;
            position: relative;
            background: white;
        }

        .calendar-date:hover {
            border-color: #00d4d4;
            background: linear-gradient(135deg, #f0fffe, #ffffff);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 212, 0.15);
        }

        .calendar-date.other-month {
            color: #cbd5e0;
            background: #f7fafc;
            cursor: default;
            border-color: #e8eef5;
        }

        .calendar-date.other-month:hover {
            border-color: #e8eef5;
            background: #f7fafc;
            transform: none;
            box-shadow: none;
        }

        .calendar-date.today {
            background: linear-gradient(135deg, #006666, #00a8a8);
            color: white;
            border-color: #006666;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(0, 102, 102, 0.25);
        }

        .calendar-date.today:hover {
            box-shadow: 0 8px 28px rgba(0, 102, 102, 0.35);
            transform: translateY(-3px);
        }

        .calendar-date.has-event::after {
            content: '';
            position: absolute;
            bottom: 6px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b, #ff5252);
            box-shadow: 0 2px 4px rgba(255, 107, 107, 0.3);
        }

        .calendar-date.today.has-event::after {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 4px rgba(68, 41, 19, 0.2);
        }

        .calendar-date.selected {
            background: rgba(0, 102, 102, 0.12);
            border-color: #006666;
            box-shadow: 0 4px 12px rgba(0, 102, 102, 0.12);
        }

        /* Sidebar */
        .calendar-sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
            animation: slideDown 0.5s ease;
        }

        /* Upcoming Events */
        .upcoming-events {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(68, 41, 19, 0.08);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            max-height: 600px;
        }

        .upcoming-events:hover {
            box-shadow: 0 8px 24px rgba(68, 41, 19, 0.12);
        }

        .upcoming-header {
            padding: 24px 28px;
            border-bottom: 1px solid #e8eef5;
            background: linear-gradient(135deg, #ffffff, #f8f9fc);
        }

        .upcoming-header h3 {
            font-size: 17px;
            font-weight: 700;
            color: #51513E;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upcoming-header h3::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #006666, #00a8a8);
            border-radius: 2px;
        }

        .upcoming-content {
            flex: 1;
            overflow-y: auto;
        }

        .upcoming-content::-webkit-scrollbar {
            width: 6px;
        }

        .upcoming-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .upcoming-content::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 3px;
        }

        .upcoming-content::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        .event-item {
            padding: 18px 28px;
            border-bottom: 1px solid #e8eef5;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .event-item:hover {
            background: linear-gradient(90deg, rgba(0, 102, 102, 0.05), transparent);
            border-left-color: #00a8a8;
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-date {
            font-size: 11px;
            font-weight: 700;
            color: #00a8a8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .event-title {
            font-size: 15px;
            font-weight: 700;
            color: #51513E;
            margin: 0 0 6px 0;
            line-height: 1.4;
        }

        .event-class {
            font-size: 12px;
            color: #8892a8;
            margin: 0;
        }

        /* Info Widgets */
        .widget-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(68, 41, 19, 0.08);
            transition: all 0.3s ease;
        }

        .widget-card:hover {
            box-shadow: 0 8px 24px rgba(68, 41, 19, 0.12);
        }

        .widget-header {
            padding: 24px 28px;
            border-bottom: 1px solid #e8eef5;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #ffffff, #f8f9fc);
        }

        .widget-header svg {
            color: #00a8a8;
            flex-shrink: 0;
        }

        .widget-header h3 {
            font-size: 17px;
            font-weight: 700;
            color: #51513E;
            margin: 0;
        }

        .widget-content {
            padding: 24px 28px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 24px;
            color: #8892a8;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state p {
            margin: 0;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .calendar-container {
                grid-template-columns: 1fr;
            }

            .calendar-sidebar {
                display: grid;
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            main.main-content {
                padding: 24px 16px;
            }

            .page-title h1 {
                font-size: 32px;
            }

            .calendar-sidebar {
                grid-template-columns: 1fr;
            }

            .calendar-grid {
                padding: 20px;
            }

            .dates-grid {
                gap: 8px;
            }

            .weekday-label {
                padding: 12px 0;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header class="header">
        <div class="header-container">
            <button class="menu-toggle" id="menuToggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>

            <div class="header-logo">
                <img src="Images/favicon.png" alt="RPH Logo" class="header-logo-img">
                <h1 class="header-title"><a href="home.html" class="header-title-link">Readings in Philippine History</a></h1>
            </div>

            <div class="header-actions">
                <div class="search-box">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" placeholder="Search" />
                </div>

                <button class="notification-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span class="notification-badge">2</span>
                </button>
                <button class="sidebar-toggle-right" id="sidebarToggleRight" title="Show more">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="15" y1="3" x2="15" y2="21"></line>
                        <line x1="9" y1="9" x2="9" y2="9.01"></line>
                        <line x1="9" y1="15" x2="9" y2="15.01"></line>
                    </svg>
                </button>
                <button class="logout-btn" title="Logout">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="main-layout">
        <!-- Left Sidebar Navigation -->
        <aside class="left-sidebar" id="leftSidebar">
            <!-- User Profile Section -->
            <div class="user-profile">
                <img src="https://i.pravatar.cc/80?img=20" alt="User avatar" class="profile-avatar" id="profileAvatar" />
                <div class="profile-info">
                    <h4 class="profile-name" id="profileName">Loading...</h4>
                    <p class="profile-email" id="profileEmail">Loading...</p>
                </div>
                <button class="edit-profile-btn" id="editProfileBtn" title="Edit profile">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </button>
            </div>

            <nav class="sidebar-nav">
                <a href="course.html" class="nav-item" data-section="feed">
                    <svg class="nav-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>Feed</span>
                </a>
                <div class="nav-item-dropdown">
                    <div class="nav-item" data-section="topic">
                        <svg class="nav-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                        <span>Topic</span>
                        <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="dropdown-menu">
                        <a href="first-mass.html" class="dropdown-item">First Mass</a>
                        <a href="cavite-mutiny.html" class="dropdown-item">Cavite Mutiny</a>
                        <a href="retraction-of-rizal.html" class="dropdown-item">Retraction of Rizal</a>
                        <a href="cry-of-rebellion.html" class="dropdown-item">Cry of Rebellion</a>
                    </div>
                </div>
                <div class="nav-item-dropdown">
                    <div class="nav-item" data-section="activities">
                        <svg class="nav-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="21 8 21 21 3 21 3 8"></polyline>
                            <line x1="1" y1="3" x2="23" y2="3"></line>
                            <path d="M10 12v4"></path>
                            <path d="M14 12v4"></path>
                            <path d="M6 8v3"></path>
                            <path d="M18 8v3"></path>
                        </svg>
                        <span>Learning Hub</span>
                        <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="dropdown-menu">
                        <a href="games.html" class="dropdown-item" data-section="games">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="6 6 18 6 18 18 6 18"></polygon>
                                <polyline points="10 9 10 15 14 15 14 9"></polyline>
                            </svg>
                            Games
                        </a>
                        <a href="worksheets.html" class="dropdown-item" data-section="worksheets">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            Worksheets
                        </a>
                        <a href="interactive-tasks.html" class="dropdown-item" data-section="interactive">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="9"></circle>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            Interactive Tasks
                        </a>
                    </div>
                </div>
                <a href="myclass.html" class="nav-item" data-section="myclass">
                    <svg class="nav-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>My Class</span>
                </a>
                <a href="calendar.html" class="nav-item active" data-section="calendar">
                    <svg class="nav-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span>Calendar</span>
                </a>
                <div class="nav-item" data-section="videos">
                    <svg class="nav-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                    <span>Videos</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Title -->
            <div class="page-title">
                <h1>Calendar</h1>
                <p>View your upcoming assignments and due dates</p>
            </div>

            <!-- Calendar Container -->
            <div class="calendar-container">
                <!-- Calendar Card -->
                <div class="calendar-card">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" id="prevMonthBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                        </button>
                        <div class="calendar-month-year" id="monthYearDisplay">January 2025</div>
                        <button class="calendar-nav-btn" id="nextMonthBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="calendar-grid">
                        <div class="weekday-header">
                            <div class="weekday-label">Sun</div>
                            <div class="weekday-label">Mon</div>
                            <div class="weekday-label">Tue</div>
                            <div class="weekday-label">Wed</div>
                            <div class="weekday-label">Thu</div>
                            <div class="weekday-label">Fri</div>
                            <div class="weekday-label">Sat</div>
                        </div>
                        <div class="dates-grid" id="datesGrid"></div>
                    </div>
                </div>

                <!-- Upcoming Events Sidebar -->
                <div class="upcoming-events">
                    <div class="upcoming-header">
                        <h3>Upcoming Due Dates</h3>
                    </div>
                    <div class="upcoming-content" id="upcomingEvents">
                        <div class="empty-state">
                            <div class="empty-state-icon">ðŸ“…</div>
                            <h3>No Upcoming Events</h3>
                            <p>Your assignments are all caught up!</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <!-- Tips Section -->
            <div class="widget">
                <div class="widget-header">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 16v-4"></path>
                        <path d="M12 8h.01"></path>
                    </svg>
                    <h3>Tips</h3>
                </div>
                <div class="widget-content">
                    <p style="font-size: 14px; line-height: 1.6; color: #7A5B47; margin: 0;">
                        Click on any date to see details about assignments due on that day. Dates with due assignments are marked with a red dot.
                    </p>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // ==================== AUTHENTICATION CHECK ====================
        // Check if user is logged in via Supabase session
        async function checkAuth() {
            try {
                // If userEmail not in localStorage, user is logged out
                if (!localStorage.getItem('userEmail')) {
                    console.log('No user email in localStorage, redirecting to login');
                    window.location.href = 'index.html';
                    return;
                }

                // Wait a bit to ensure Supabase is fully initialized
                await new Promise(resolve => setTimeout(resolve, 100));

                if (!window.supabaseClient) {
                    console.error('Supabase client not initialized');
                    window.location.href = 'index.html';
                    return;
                }

                const { data: { session } } = await window.supabaseClient.auth.getSession();

                if (!session) {
                    console.log('No active session, redirecting to login');
                    window.location.href = 'index.html';
                    return;
                }

                console.log('User authenticated:', session.user.email);
            } catch (error) {
                console.error('Auth check error:', error);
                // If error checking auth, redirect to login to be safe
                window.location.href = 'index.html';
            }
        }

        // Sample event data - In production, this would come from Supabase
        const calendarEvents = [
            {
                date: '2025-01-15',
                title: 'Cavite Mutiny Essay',
                class: 'Topic 1: Cavite Mutiny',
                priority: 'high',
                description: 'Submit your 2000-word essay analyzing the causes and outcomes of the Cavite Mutiny'
            },
            {
                date: '2025-01-20',
                title: 'Quiz 1: Historical Timeline',
                class: 'Activities: Quizzes',
                priority: 'high',
                description: 'Test your knowledge on key historical dates and events'
            },
            {
                date: '2025-01-28',
                title: 'Interactive Task: Document Analysis',
                class: 'Activities: Interactive Tasks',
                priority: 'medium',
                description: 'Complete the document analysis task on primary sources'
            },
            {
                date: '2025-02-05',
                title: 'Retraction of Rizal Essay',
                class: 'Topic 2: Retraction of Rizal',
                priority: 'high',
                description: 'Analyze Rizal\'s retraction and its historical significance'
            },
            {
                date: '2025-02-14',
                title: 'Quiz 2: Comprehensive Review',
                class: 'Activities: Quizzes',
                priority: 'high',
                description: 'Final quiz covering all course materials'
            },
            {
                date: '2025-02-10',
                title: 'Gaming Activity: Historical Scenario',
                class: 'Activities: Games',
                priority: 'low',
                description: 'Complete the historical scenario game'
            }
        ];

        let currentDate = new Date();

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function getEventsForDate(dateStr) {
            return calendarEvents.filter(event => event.date === dateStr);
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Update month/year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('monthYearDisplay').textContent = `${monthNames[month]} ${year}`;

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            const datesGrid = document.getElementById('datesGrid');
            datesGrid.innerHTML = '';

            // Previous month dates
            for (let i = firstDay - 1; i >= 0; i--) {
                const dateDiv = document.createElement('div');
                dateDiv.className = 'calendar-date other-month';
                dateDiv.textContent = daysInPrevMonth - i;
                datesGrid.appendChild(dateDiv);
            }

            // Current month dates
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateDiv = document.createElement('div');
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const events = getEventsForDate(dateStr);
                
                dateDiv.className = 'calendar-date';
                if (events.length > 0) {
                    dateDiv.classList.add('has-event');
                }
                
                // Check if today
                if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
                    dateDiv.classList.add('today');
                }
                
                dateDiv.textContent = day;
                dateDiv.addEventListener('click', () => selectDate(dateStr));
                datesGrid.appendChild(dateDiv);
            }

            // Next month dates
            const totalCells = datesGrid.children.length;
            const remainingCells = 42 - totalCells; // 6 rows Ã— 7 days
            for (let day = 1; day <= remainingCells; day++) {
                const dateDiv = document.createElement('div');
                dateDiv.className = 'calendar-date other-month';
                dateDiv.textContent = day;
                datesGrid.appendChild(dateDiv);
            }

            updateUpcomingEvents();
        }

        function selectDate(dateStr) {
            const events = getEventsForDate(dateStr);
            const upcomingContainer = document.getElementById('upcomingEvents');
            
            if (events.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">âœ“</div>
                        <h3>No Due Dates</h3>
                        <p>Nothing due on this day!</p>
                    </div>
                `;
            } else {
                upcomingContainer.innerHTML = events.map(event => `
                    <div class="event-item">
                        <div class="event-date">${new Date(event.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</div>
                        <h4 class="event-title">${event.title}</h4>
                        <p class="event-class">${event.class}</p>
                        <span class="event-priority ${event.priority}">${event.priority}</span>
                    </div>
                `).join('');
            }
        }

        function updateUpcomingEvents() {
            const today = new Date();
            const upcomingByDate = {};
            
            // Get all unique dates with events
            calendarEvents.forEach(event => {
                const eventDate = new Date(event.date);
                if (eventDate >= today) {
                    if (!upcomingByDate[event.date]) {
                        upcomingByDate[event.date] = [];
                    }
                    upcomingByDate[event.date].push(event);
                }
            });

            // Sort by date
            const sortedDates = Object.keys(upcomingByDate).sort();

            const upcomingContainer = document.getElementById('upcomingEvents');
            if (sortedDates.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸŽ‰</div>
                        <h3>All Caught Up!</h3>
                        <p>No upcoming assignments</p>
                    </div>
                `;
            } else {
                upcomingContainer.innerHTML = sortedDates.slice(0, 5).map(dateStr => 
                    upcomingByDate[dateStr].map(event => `
                        <div class="event-item">
                            <div class="event-date">${new Date(event.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                            <h4 class="event-title">${event.title}</h4>
                            <p class="event-class">${event.class}</p>
                            <span class="event-priority ${event.priority}">${event.priority}</span>
                        </div>
                    `).join('')
                ).join('');
            }
        }

        function setupMenus() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebarToggleRight = document.getElementById('sidebarToggleRight');

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    const sidebar = document.getElementById('leftSidebar');
                    if (sidebar) {
                        sidebar.classList.toggle('mobile-open');
                    }
                });
            }

            if (sidebarToggleRight) {
                sidebarToggleRight.addEventListener('click', () => {
                    const rightSidebar = document.querySelector('.right-sidebar');
                    if (rightSidebar) {
                        rightSidebar.classList.toggle('mobile-open');
                    }
                });
            }
        }

        function initialize() {
            setupMenus();
            renderCalendar();

            // Month navigation
            document.getElementById('prevMonthBtn').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            document.getElementById('nextMonthBtn').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }

        // Check authentication on page load
        checkAuth();
    </script>
</body>
</html>

