<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Concept Map - RPH Learning Hub</title>
    <link rel="icon" href="Images/favicon.png" type="image/png">
    <link rel="stylesheet" href="Styles/structured-concept-map.css">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Interactive Concept Map</h1>
                <p>Build connections and explore relationships</p>
            </div>
            <div class="header-actions">
                <span id="userDisplay" class="user-display"></span>
                <button class="btn-logout" onclick="logout()" title="Sign out">
                    Logout
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Map Selector Section -->
        <div class="map-selector-section">
            <label for="mapSelector">Choose a Topic:</label>
            <select id="mapSelector" onchange="switchMap()">
                <option value="">Loading topics...</option>
            </select>
            <span class="map-description" id="mapDescription"></span>
        </div>

        <div class="instructions">
            <h3>Instructions:</h3>
            <p><strong>Add one word</strong> related to the root concept. <strong>Choose which node to connect to</strong> for hierarchy. <strong>Add relationship labels</strong> to describe connections. <strong>Drag your node</strong> to organize. <strong>Right-click your word</strong> to edit/delete. You can only add <strong>ONE word per map</strong>!</p>
        </div>

        <div class="controls">
            <button class="btn-back" onclick="window.location.href='interactive-tasks.html'">‚Üê Back</button>
            <button class="btn-primary" onclick="openAddWordModal()">Add Related Word</button>
            <button class="btn-refresh" onclick="refreshMapData()">Refresh</button>
            <button class="btn-clear" onclick="clearAllNodes()">Delete My Word</button>
            <div class="export-menu">
                <button class="btn-export" onclick="toggleExportMenu()">Export ‚ñº</button>
                <div id="exportDropdown" class="export-dropdown">
                    <button onclick="exportAsImage()">Export as Image (PNG)</button>
                    <button onclick="exportAsJSON()">Export as JSON</button>
                </div>
            </div>
            <div class="node-count">
                <span id="nodeCount">0</span> related words
            </div>
            <div class="last-updated">
                <span id="lastUpdated">Last updated: Never</span>
            </div>
        </div>

        <div class="map-container">
            <svg id="conceptMap" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet">
                <!-- SVG content will be generated by JavaScript -->
            </svg>
        </div>
    </div>

    <!-- Add Word Modal -->
    <div id="addWordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Related Word</h2>
                <button class="close-btn" onclick="closeAddWordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-guidance">
                    <div class="info-banner">
                        <span class="info-icon">üí°</span>
                        <div class="info-text">
                            <strong>Choose wisely!</strong> Each node can connect to a maximum of <strong>15 words</strong>. 
                            Building hierarchical connections (connecting to related words rather than just the root) creates a richer, more organized concept map.
                        </div>
                    </div>
                </div>
                
                <label for="relatedWord">Enter a word related to "<span id="modalRootWord">Philippine History</span>":</label>
                <input type="text" id="relatedWord" placeholder="e.g., Revolution, Heroes, Independence" autofocus>
                
                <div class="connection-select">
                    <label for="parentNode">Connect to:</label>
                    <select id="parentNode" onchange="updateParentCapacityInfo()">
                        <option value="root">Root (Center)</option>
                    </select>
                    <div id="capacityInfo" class="capacity-info"></div>
                </div>

                <div class="relationship-input">
                    <label for="relationshipLabel">Relationship label (optional):</label>
                    <input type="text" id="relationshipLabel" placeholder="e.g., caused by, led to, part of">
                </div>
                
                <div class="color-options">
                    <div>
                        <label>Choose a color (optional):</label>
                        <div style="display: flex; gap: 10px;">
                            <div class="color-option selected" data-color="#4A90E2" style="background: #4A90E2;" onclick="selectColor(this)"></div>
                            <div class="color-option" data-color="#2E7D32" style="background: #2E7D32;" onclick="selectColor(this)"></div>
                            <div class="color-option" data-color="#E53935" style="background: #E53935;" onclick="selectColor(this)"></div>
                            <div class="color-option" data-color="#F57C00" style="background: #F57C00;" onclick="selectColor(this)"></div>
                            <div class="color-option" data-color="#5E35B1" style="background: #5E35B1;" onclick="selectColor(this)"></div>
                            <div class="color-option" data-color="#00897B" style="background: #00897B;" onclick="selectColor(this)"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeAddWordModal()">Cancel</button>
                <button class="btn-add" onclick="addRelatedWord()">Add Word</button>
            </div>
        </div>
    </div>

    <!-- Supabase Configuration -->
    <script src="JS/supabase-config.js"></script>
    <!-- Database Helper -->
    <script src="JS/concept-map-db.js"></script>
    <!-- Main Script -->
    <script src="JS/structured-concept-map.js"></script>
</body>
</html>
